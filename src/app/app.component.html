<div id="cdot" #cdot aria-hidden="true"></div>
<div id="cring" #cring [class.big]="cursorHover()" aria-hidden="true"><span class="cl">VIEW</span></div>

<div id="prvw" #prvw [class.on]="previewActive() !== null" aria-hidden="true">
   <!-- Loop through first 5 projects for preview -->
   @for (proj of data.projects; track proj.num; let i = $index) {
     <div class="psc" [class.act]="previewActive() === i">
       <div class="psc-img-wrap">
         <!-- Shows the first image of the project -->
         <img [src]="proj.imgs[0]" [alt]="proj.name" style="width:100%; height:100%; object-fit:cover;">
         <div class="psc-overlay"></div>
       </div>
       <div class="psc-meta">
         <span class="psc-name">{{ proj.name }}</span>
         <span class="psc-tag">{{ proj.tags[0] }}</span>
       </div>
     </div>
   }
</div>

<div class="app-root" [attr.data-page]="nav.currentPage()">
  <app-sidebar />

  <header class="mobnav" role="banner">
<a href="#" class="mlogo" (click)="goTo(0); $event.preventDefault()">
      @if (nav.isDark()) {
        <img src="assets/logo-dark.png" alt="Jaren Kendrick" />
      } @else {
        <img src="assets/logo-light.png" alt="Jaren Kendrick" />
      }
    </a>
    <div class="mnr">
      <button class="thm" (click)="nav.toggleTheme()" aria-label="Toggle theme">
        <div class="tknob">
          @if (nav.isDark()) { <svg viewBox="0 0 24 24" width="11" height="11" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg> } 
          @else { <svg viewBox="0 0 24 24" width="11" height="11" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/></svg> }
        </div>
      </button>
      <button class="mbg" [class.open]="mobileMenuOpen()" (click)="mobileMenuOpen.set(!mobileMenuOpen())" aria-label="Toggle menu" [attr.aria-expanded]="mobileMenuOpen()">
        <span></span><span></span><span></span>
      </button>
    </div>
  </header>

  @if (mobileMenuOpen()) {
    <nav class="mobmenu" role="navigation">
      @for (item of data.navItems; track item.index) {
        <a (click)="goTo(item.index)" [class.on]="nav.currentPage() === item.index">0{{ item.index + 1 }} {{ item.label }}</a>
      }
    </nav>
  }

  <main class="main-content">
    <div class="page-slider">
      <!-- Logic: Component receives [active]="true" only when slide finishes. 
           Slide handles transition, directive handles the glitch effect. -->
      
      <app-home class="page-section" 
        [class.active]="nav.currentPage() === 0" 
        [class.prev]="nav.currentPage() > 0"
        [active]="nav.currentPage() === 0"
        (projectOpened)="openProject($event)" 
        (previewHover)="setPreview($event)">
      </app-home>

      <app-about class="page-section" 
        [class.active]="nav.currentPage() === 1" 
        [class.prev]="nav.currentPage() > 1"
        [class.next]="nav.currentPage() < 1"
        [active]="nav.currentPage() === 1">
      </app-about>

      <app-projects class="page-section" 
        [class.active]="nav.currentPage() === 2" 
        [class.prev]="nav.currentPage() > 2"
        [class.next]="nav.currentPage() < 2"
        [active]="nav.currentPage() === 2"
        (projectOpened)="openProject($event)" 
        (previewHover)="setPreview($event)">
      </app-projects>

      <app-experience class="page-section" 
        [class.active]="nav.currentPage() === 3" 
        [class.prev]="nav.currentPage() > 3"
        [class.next]="nav.currentPage() < 3"
        [active]="nav.currentPage() === 3">
      </app-experience>

      <app-blog class="page-section" 
        [class.active]="nav.currentPage() === 4" 
        [class.prev]="nav.currentPage() > 4"
        [class.next]="nav.currentPage() < 4"
        [active]="nav.currentPage() === 4"
        (postOpened)="openBlog($event)">
      </app-blog>

      <app-testimonials class="page-section" 
        [class.active]="nav.currentPage() === 5" 
        [class.prev]="nav.currentPage() > 5"
        [class.next]="nav.currentPage() < 5"
        [active]="nav.currentPage() === 5">
      </app-testimonials>

      <app-contact class="page-section" 
        [class.active]="nav.currentPage() === 6" 
        [class.prev]="nav.currentPage() > 6"
        [class.next]="nav.currentPage() < 6"
        [active]="nav.currentPage() === 6">
      </app-contact>
    </div>
  </main>

  @if (activeProject()) { <app-project-overlay [project]="activeProject()" (closed)="closeProject()" /> }
  @if (activeBlogPost()) { <app-blog-overlay [post]="activeBlogPost()" (closed)="closeBlog()" /> }
  
  <app-terminal #terminal />
</div>